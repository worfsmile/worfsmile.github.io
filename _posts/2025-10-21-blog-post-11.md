---
title: 'Wall-E'
date: 2025-10-21
permalink: /posts/2025/10/blog-post-11/
tags:

---

Wall-E
======

探究 LLM 能不能作为一个有效的 world model, 将基于LLM的世界模型与动态环境对齐
gap between prior knowledge of LLMs and the specified environment’s dynamics
通过在大型语言模型上进行规则学习, 可以高效实现LLM与其部署环境的对齐, 这种 “世界对齐” 过程。

1. model-predictive control

![wall-e](https://worfsmile.github.io//assets/images/2025-10-21-blog-post-11/image.png)

MPC:
(模型固定, 控制在变)
x_real(t) ─► 优化控制序列 u_t ─► 执行第一个动作 ─► 再测x_real(t+1) ─► 再优化

Online Learning:
(模型在变, 决策策略随模型变)
样本 (x_t, y_t) ─► 更新参数 θ_t ─► 预测下一个 y_{t+1} ─► 再更新 θ_{t+1}

预测世界状态
$$
\hat{s}_{t+1} = f_{WM}(s_t, a_t)
$$

定义优化目标
$$
a^{*}_{t:t+H} = arg \underset{a_{t:t+H}}{max} \mathbf{E}[\sum^{H}_{i=0}\gamma^i \mathcal{F}(\hat{s}_{t+i+1})]
$$

2. Wall-E

$$
\hat{s}_{t+1} = (\text{action\_result}_{t+1}, \text{stat\_info}_{t+1}) = f_{WM}(s_t, a_t)
$$

预测对齐
$$
\begin{align*}
&D^{correct} = \{\delta^{correct}_{t} = (s_t, a_t, \hat{s}_{t+1})| \hat{s}_{t+1} = s_{t+1} \} \\
&D^{incorrect} = \{\delta^{incorrect}_{t} = (s_t, a_t, s_{t+1})| \hat{s}_{t+1} \neq s_{t+1} \} \\
\end{align*}
$$

则真实世界
$$
\tau^{real} = D^{correct} \cup D^{incorrect}
$$

规则学习

- 从 $\tau^{real}$ 生成规则
- 随现实世界更新规则
- 规则转化为行为代码
- 从错误改正规则
- 获得规则集

$$
\begin{align*}
&\text{Let}\\
&R^{code} = \{R^{code}_i\}_{i=1}^{m}\\
&D^{incorrect} = \{\delta^{incorrect}_{t}\}_{t=1}^{n}\\
&\underset{x\in\{0,1\}^{m},y\in\{0,1\}^{n}}{\text{max}}\{\sum^{n}_{j=1}y_i-\lambda\sum^{m}_{i=1}x_i|y_{i}\leq \sum^{m}_{i=1}x_{i}a_{ij},\forall j=1\dots n\}\\
\end{align*}
$$

- init 

用LLM基于预先的场景定义一些规则

- 循环:

进行决策, 预测环境变化, 

得到环境变化对比预测的和真实的环境变化

把错误的环境变化输入给模型进行策略更新, 同时根据新的环境场景更新策略集

用最大覆盖来获得策略集



规则示例 (app. D)

| Rule   | 动作   | 失败条件                     | 检查方法                                            |
| ------ | ------ | ---------------------------- | --------------------------------------------------- |
| Rule 3 | craft  | 平台错误或未指定             | 检查 action 中的 platform 是否匹配 obj 要求         |
| Rule 6 | craft  | 材料不足                     | 检查 inventory 中是否有足够材料                     |
| Rule 2 | mine   | 工具不适用                   | 检查 action.args.tool 是否适合 action.args.obj      |
| Rule 7 | mine   | 工具不在库存                 | 检查 inventory 中是否有工具                         |
| Rule 2 | gather | 光照不足                     | 检查 location_stats.sky_light_level < 1.0           |
| Rule 1 | fight  | 工具不在 inventory/equipment | 检查 action 中工具是否存在于 inventory 或 equipment |
