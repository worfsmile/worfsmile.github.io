---
title: 'PhysDreamer'
date: 2025-10-25
permalink: /posts/2025/10/blog-post-15/
tags:

---

物理仿真

仿真对象
表达方式
交互方式

有一个GS模型, 由视频生成模型生成动态视频(带有物理信息), PhysDreamer从视频中的视觉信息中获得物理材质场, 包括杨氏模量(主要估计对象), 质量(估计获得), 泊松比(假设为常量)等, 然后用动力学来使GS动起来

**大致过程**

将静态的高斯物体渲染后(第0帧), 输入到交互式视频生成模型, 生成对应的动态视频
初始化一个物理场, 根据物理场来构建GS的新状态, 然后渲染成帧和之前的视频生成模型做损失

- 估计
- simulation
- rendering
- loss function

## 计算初速度和外力


### 修正共旋超弹性模型 (Fixed Corotated Hyperelastic Model)

能量密度函数

$$
\psi(\mathbf{F}) = \mu \sum_{i=1}^{d} (\sigma_i - 1)^2 + \frac{\lambda}{2} (\det(\mathbf{F}) - 1)^2
$$

#### 各符号解释

1. $\mathbf{F} = \nabla_X \phi(X,t)$

   - 变形梯度 (deformation gradient), 描述材料从未变形空间 (X) 到变形空间 (x = \phi(X,t)) 的局部变形。
   - 它包含了旋转、拉伸和剪切信息。

2. $\sigma_i$

   - $\mathbf{F}$ 的奇异值 (singular values), 对应局部沿主方向的拉伸比例。
   - $\sigma_i - 1$ 就表示在第 (i) 个主方向的应变大小。

3. $\mu$ 和 $\lambda$

   - Lame 常数 (Lamé constants), 用于描述材料的弹性性质。
   - 与杨氏模量 (E) 和泊松比 (\nu) 的关系：
     $$
     \mu = \frac{E}{2(1+\nu)}, \quad
     \lambda = \frac{E\nu}{(1+\nu)(1-2\nu)}
     $$

4. $\det(\mathbf{F}) - 1$

   - 体积变形 (volumetric deformation) $\det(\mathbf{F})$ 表示局部体积的缩放比例。
   - 如果材料不可压缩, 则 $\det(\mathbf{F})\approx 1$
   - 第二项是体积能量, 用来阻止材料体积过大或过小。

### 动力学方程

$$
\rho \frac{D \mathbf{v}}{Dt} = \nabla \cdot \boldsymbol{\sigma} + \mathbf{f}, \quad
\frac{D \rho}{Dt} + \rho \nabla \cdot \mathbf{v} = 0
$$
描述了速度和时间的关系

#### 各符号解释

1. $\rho$

   - 材料密度 (density), 单位体积质量。

2. $\mathbf{v}(x,t)$

   - 速度场 (velocity field), 描述材料中每个点在世界空间的速度。

3. $\frac{D}{Dt}$

   - 材料导数 (material derivative), 表示跟随材料点的时间变化
     $$
     \frac{D}{Dt} = \frac{\partial}{\partial t} + \mathbf{v}\cdot\nabla
     $$

4. $\boldsymbol{\sigma}$

   - Cauchy应力张量 (Cauchy stress tensor), 由能量密度函数 $\psi(\mathbf{F})$ 计算得出：
     $$
     \boldsymbol{\sigma} = \frac{1}{\det(\mathbf{F})} \frac{\partial \psi}{\partial \mathbf{F}} \mathbf{F}^T
     $$

5. $\nabla \cdot \boldsymbol{\sigma}$

   - 应力散度 (stress divergence), 对应内力密度, 是材料受力导致加速度的来源。

6. $\mathbf{f}$

   - 外力密度 (external force per unit volume), 例如重力或外部施加的力。

7. 连续性方程 $\frac{D\rho}{Dt} + \rho \nabla \cdot \mathbf{v} = 0$

   - 保证质量守恒, 表示材料密度随流动而变化。

8. $\frac{D \mathbf{v}}{D t}$表示$\frac{\partial \mathbf{v}}{\partial t}​ + (\mathbf{v}·\nabla)\mathbf{v}$

#### 总结

$\psi(\mathbf{F})$ 给出材料的应力-应变关系
动力学方程 $\rho D\mathbf{v}/Dt = \nabla\cdot\boldsymbol{\sigma} + \mathbf{f}$ 描述材料如何响应内力和外力运动。
固定共旋 (fixed corotated) 在计算应力时对局部旋转进行校正, 使弹性力更稳定, 尤其适合大变形。

## 解方程

### MPM

MPM 的目标是离散求解以下**连续介质动力学方程**：

$$
\rho \frac{D\mathbf{v}}{Dt} = \nabla \cdot \boldsymbol{\sigma} + \mathbf{f}
\quad \text{and} \quad
\frac{D\mathbf{x}}{Dt} = \mathbf{v}
$$

其中

- $\rho$：密度
- $\mathbf{v}$速度场
- $\boldsymbol{\sigma}$应力张量
- $\mathbf{f}$外力（如重力）
- $D/Dt$物质导数（沿着粒子路径的导数）

我们要的最终结果是粒子的位置：
$$
\mathbf{x}_p(t)
$$

MPM 在每个时间步中执行以下循环

**P2G 阶段 粒子到网格**

每个粒子 (p) 代表一个小体积 (V_p) 有

$$
m_p, \quad \mathbf{x}_p^t, \quad \mathbf{v}_p^t, \quad \mathbf{F}_p^t, \quad \mathbf{C}_p^t
$$

其中

- $\mathbf{F}_p$形变梯度 描述局部拉伸/旋转
- $\mathbf{C}_p$速度梯度的近似

我们将粒子的物理量通过插值核函数 $N(\mathbf{x}_i - \mathbf{x}_p)$传到网格节点 (i)

网格节点质量

$$
m_i^t = \sum_p N(\mathbf{x}_i - \mathbf{x}_p^t) m_p
$$

网格节点动量

$$
m_i^t \mathbf{v}_i^t =
\sum_p N(\mathbf{x}_i - \mathbf{x}_p^t)
\Big[
m_p \mathbf{v}_p^t + \\
\big(m_p \mathbf{C}_p^t - \frac{4}{(\Delta x)^2}\Delta t V_p \frac{\partial \psi}{\partial \mathbf{F}} {\mathbf{F}_p^t}^T\big)(\mathbf{x}_i - \mathbf{x}_p^t)
\Big] + \mathbf{f}_i^t
$$

解释

| 符号                                          | 含义                             |
| ------------------------------------------- | ------------------------------ |
| $N(\mathbf{x}_i - \mathbf{x}_p)$            | 插值函数（通常是 B 样条或线性权重）            |
| $\frac{\partial \psi}{\partial \mathbf{F}}$ | 从能量函数导出的应力 Fixed Corotated 模型 |
| $frac{4}{(\Delta x)^2}$                    | 空间插值的权重因子                      |
| $\mathbf{f}_i^t$                            | 外力（如重力）贡献                      |
| $\mathbf{C}_p$                              | 局部速度梯度，辅助动量传输                  |

这一步
每个粒子把它的质量、动量、应力传给周围的网格节点

更新动量求解 PDE

得到每个网格节点的质量 $m_i^t$ 和动量 $m_i^t\mathbf{v}_i^t$ 后，
我们可以求加速度、更新速度：

$$
\mathbf{a}_i = \frac{\mathbf{f}_i}{m_i}, \quad
\mathbf{v}_i^{t+\Delta t} = \mathbf{v}_i^t + \Delta t , \mathbf{a}_i
$$


**G2P 阶段网格到粒子**

计算完网格节点的新速度后，
我们要把这些速度插值回粒子并

- 更新位置与形变

$$
\mathbf{v}_p^{t+1} = \sum_i N(\mathbf{x}_i - \mathbf{x}_p^t)\mathbf{v}_i^t\\
\mathbf{x}_p^{t+1} = \mathbf{x}_p^t + \Delta t , \mathbf{v}_p^{t+1}
$$

这样我们就获得了粒子新的速度和位置。

- 更新形变与局部速度梯度

形变梯度 $\mathbf{F}_p$ 和局部速度场梯度 $\mathbf{C}_p$ 由网格速度场导出

$$
\mathbf{C}_p^{t+1} = \frac{4}{(\Delta x)^2} \sum_i N(\mathbf{x}_i - \mathbf{x}_p^t) \mathbf{v}_i^t (\mathbf{x}_i - \mathbf{x}_p^t)^T\\
\mathbf{F}_p^{t+1} = (\mathbf{I} + \Delta t \sum_i \mathbf{v}_i^t \nabla N(\mathbf{x}_i - \mathbf{x}_p^t)^T ) \mathbf{F}_p^t
$$

它们记录材料的局部变形历史是应力计算的核心变量

Fixed Corotated 模型定义了能量函数

$$
\psi(\mathbf{F}) = \mu |\mathbf{F} - \mathbf{R}|^2 + \frac{\lambda}{2} (\text{tr}(\mathbf{R}^T \mathbf{F}) - 3)^2
$$

其中 $\mathbf{R}$ 来自极分解Polar Decomposition

$$
\mathbf{F} = \mathbf{R}\mathbf{S}
$$

从该能量函数可导出应力
$$
\frac{\partial \psi}{\partial \mathbf{F}} = 2\mu (\mathbf{F} - \mathbf{R}) + \lambda (\text{tr}(\mathbf{R}^T \mathbf{F}) - 3)\mathbf{R}
$$

## 完整流程

1. 单步

$$
\mathbf{x}^{t+1}, \mathbf{v}^{t+1}, \mathbf{F}^{t+1}, \mathbf{C}^{t+1} = \mathcal{S}(\mathbf{x}^{t}, \mathbf{v}^{t}, \mathbf{F}^{t}, \mathbf{C}^{t}, \boldsymbol{\theta}, \Delta t)
$$

- 粒子位置向量 `[x₁, …, x_P]`
- 粒子速度向量 `[v₁, …, v_P]`
- 粒子形变梯度
- 粒子局部速度梯度（记录速度变化方向）
- 粒子的物理属性集合 质量 m、杨氏模量 E、泊松比 ν、体积 V
- 仿真步长例如 1e-4

2. 多步

$$
\mathbf{x}^{t+1}, \mathbf{v}^{t+1}, \mathbf{F}^{t+1}, \mathbf{C}^{t+1} = \mathcal{S}(\mathbf{x}^{t}, \mathbf{v}^{t}, \mathbf{F}^{t}, \mathbf{C}^{t}, \boldsymbol{\theta}, \Delta t, N)
$$

3. 可微渲染Differentiable Rendering

$$
\hat{I}^{t} = \mathcal{F}_{\text{render}}(\mathbf{x}^{t}, \boldsymbol{\alpha}, \mathbf{R}^{t}, \Sigma, \mathbf{c})
$$

- Frender 可微渲染函数，把 3D 粒子渲染成图像
- Rt 粒子的旋转信息
- $\Sigma, c, \alpha$ 粒子形状、颜色等渲染属性

4. 生成的渲染帧可以和真实视频帧对比用于优化材料参数

$$
L^t = \lambda L_1(\hat{I}^t, I^t) + (1-\lambda) L_{\text{D-SSIM}}(\hat{I}^t, I^t)
$$

- L1像素误差
- D-SSIM 结构相似性损失
- λ = 0.1 加权

通过梯度下降让模拟粒子运动在渲染后尽量匹配真实视频

5. 材料场与速度场参数化

- 使用 triplane + MLP 表示空间上每个粒子的杨氏模量 E 和初速度 v₀
- 加入 Total Variation 正则
  $$
  L_{\text{tv}} = \sum_{i,j} |\mathbf{u}*{i+1,j} - \mathbf{u}*{i,j}|^2 + |\mathbf{u}*{i,j+1} - \mathbf{u}*{i,j}|^2
  $$

保证空间上的材料属性平滑，不会跳跃。

6. 两阶段优化参数

   1. 优化初速度 v₀

      - 杨氏模量 E 固定
      - 使用前三帧视频优化速度

   2. 优化材料属性 E

      - v₀ 固定

      - 使用整个视频优化空间分布的杨氏模量
